<mxfile host="app.diagrams.net" modified="2024-05-23T03:10:52.325Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36" etag="yR3WVsvGS9PGpK9jenT2" version="24.4.6" type="github">
  <diagram name="第 1 页" id="_TC1i7395d7Ko6areE1A">
    <mxGraphModel dx="1434" dy="780" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Gp8K34Z30wctiOWK-yPE-38" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="53" y="585" width="757" height="325" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-2" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.basic.patternFillRect;fillStyle=solid;step=5;fillStrokeWidth=0.2;fillStrokeColor=#dddddd;gradientColor=none;fillColor=#78A9FF;" parent="1" vertex="1">
          <mxGeometry x="220" y="460" width="446" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-3" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;strokeWidth=2;shape=mxgraph.arrows2.arrow;dy=0.6;dx=40;notch=0;" parent="1" vertex="1">
          <mxGeometry x="110" y="467.5" width="90" height="25" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-11" value="左边添加推送数据" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="350" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-12" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;strokeWidth=2;shape=mxgraph.arrows2.arrow;dy=0.6;dx=40;notch=0;" parent="1" vertex="1">
          <mxGeometry x="690" y="467.5" width="90" height="25" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-13" value="右边移除推送数据" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="670" y="360" width="100" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-14" value="起草" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="560" y="460" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-15" value="审批" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="470" y="460" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-18" value="归档" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="384" y="460" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-19" value="办结" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="280" y="460" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-20" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.basic.patternFillRect;fillStyle=solid;step=5;fillStrokeWidth=0.2;fillStrokeColor=#dddddd;gradientColor=none;fillColor=#78A9FF;" parent="1" vertex="1">
          <mxGeometry x="220" y="670" width="446" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-22" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;strokeWidth=2;shape=mxgraph.arrows2.arrow;dy=0.6;dx=40;notch=0;" parent="1" vertex="1">
          <mxGeometry x="680" y="670" width="90" height="25" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-23" value="起草" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="560" y="670" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-24" value="审批" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="470" y="670" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-27" value="" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.basic.patternFillRect;fillStyle=solid;step=5;fillStrokeWidth=0.2;fillStrokeColor=#dddddd;gradientColor=none;fillColor=#78A9FF;" parent="1" vertex="1">
          <mxGeometry x="218" y="800" width="446" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-31" value="审批" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="560" y="800" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-33" value="办结" style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="278" y="800" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-34" value="..." style="verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.flowchart.on-page_reference;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="382" y="800" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-35" value="流程实例2" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="770" width="176" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-36" value="流程实例1" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="640" width="176" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-39" value="机器人遍历所有需要推送的流程实例数据，从右边获取数据" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="53" y="585" width="176" height="65" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-40" value="推送失败,阻塞,等待下次机器人触发" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="664" y="807.5" width="146" height="72.5" as="geometry" />
        </mxCell>
        <mxCell id="Gp8K34Z30wctiOWK-yPE-41" value="推送成功,移除" style="shape=note;size=20;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="670" y="702.5" width="146" height="55" as="geometry" />
        </mxCell>
        <mxCell id="nAUrakrfVr3jxSXGwhte-1" value="&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;流程引擎：流转状态推送设计优化&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;1. 类别管理-类别属性中增加推送接口&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;2. 每个流程实例推送步骤放入各自的队列中&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;redisTemplate.opsForList().leftPush(&quot;flowPush_&quot;+fileId,flowInfo);//添加推送数据&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;3. 机器人执行推送&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;查询类别管理中配置了推送接口的流程实例&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;遍历流程实例&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; Object flowInfo = redisTemplate.opsForList().index(&quot;flowPush_&quot;+fileId,1);&amp;nbsp; //获取推送数据&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 判断是否有推送数据&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;&amp;nbsp; 有：调用推送接口&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;执行成功,从队列中移除 redisTemplate.opsForList().rightPop(&quot;flowPush_&quot;+fileId);//移除&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp;执行失败,队列数据不做处理,处于阻塞状态,等待下次机器人执行;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;&amp;nbsp; 无：继续循环&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="shape=note;size=20;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="100" y="30" width="659" height="320" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
